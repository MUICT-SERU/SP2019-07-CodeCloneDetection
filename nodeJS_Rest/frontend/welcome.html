<html lang="en">

<head>
	<style>
	a {
	font-size: 50;
	padding-top: 50px;
	padding-left: 25px;
}
	</style>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
		 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
		 <link href="styles.css" rel="stylesheet" />

</head>

<body>
	<nav class="navbar navbar-expand-md navbar-light bg-light">
			<ul class="nav">
					<li class="nav-item">
							<a class="nav-link">
								<img src="/images/logo.png" alt="Merry's logo" style="width:70px;height:70px;">
							</a>
					</li>
				</ul>
			</div>
 <ul class="nav justify-content-end" id="menu" style="padding-left:87%">
	 	<li class="nav-item"id="ProPic" style="padding-right:">

		</li>
					<li class="nav-item">
							<b class="nav-link" id="logout-button" onclick="logoutFunc()" style="padding-top:30%">Logout</b>
					</li>
				</ul>
	</div>
</nav>

<a id="Repos"> Repositories of </a>
<table id="showRepos" class="table table-bordered" style="width:98%" align="center">
	<thead>
<tr>
	<th>No.</th>
	<th>Repository's Name</th>
	<th>Clone URL</th>
	<th>Action</th>
</tr>
</thead>
</table>

 <!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalCenter">
  Launch demo modal
</button>

<div class="modal fade" id="ModalCenter" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="ModalCenterTitle">Processing please wait...</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

				<div class="d-flex align-items-center">
					 <strong style="font-size:16px" >Cloning from GitHub</strong>
					 <div style="padding-right:30%">
	<div class="circle-loader">
	  <div class="checkmark draw"></div>
	</div>
</div>
</div>
	<div class="d-flex align-items-center" style="padding-top:3%">
		<strong style="font-size:16px">Analyzing Clone</strong>
<div class="circle-loader" >
  <div class="checkmark draw"></div>
</div>
      </div>

			<p><button id="toggle" type="button" class="btn btn-success">Toggle Completed</button></p>
    </div>
  </div>
</div>


</body>
<script>
	// We can get the token from the "access_token" query
	// param, available in the browsers "location" global
	const query = window.location.search.substring(1)
	const token = query.split('access_token=')[1]

	$('#toggle').click(function() {
	  $('.circle-loader').toggleClass('load-complete');
	  $('.checkmark').toggle();
	});

	fetch('https://api.github.com/user',{
		headers: new Headers({
        'Authorization': 'token ' + token,
    		}),
			}, {method : 'GET'})
		// Parse the response as JSON
		.then(res => res.json())
		.then(res =>{
			const NameOwner = document.createTextNode(`${res.login}`)
			document.getElementById("Repos").appendChild(NameOwner)
			const ProfilePicture = document.createElement("img")
			ProfilePicture.setAttribute("style","width:70px;height:70px;")
			ProfilePicture.setAttribute("class", "img-thumbnail")
			ProfilePicture.src = `${res.avatar_url}`;

			document.getElementById("ProPic").appendChild(ProfilePicture)

		})

	// Call the user info API using the fetch browser library
	fetch('https://api.github.com/user/repos', {
		headers: new Headers({
        'Authorization': 'token ' + token,
    		}),
			})
		// Parse the response as JSON
		.then(res => res.json())
		.then(res => {
			// Once we get the response (which has many fields)
			// Documented here: https://developer.github.com/v3/users/#get-the-authenticated-user
			// Write "Welcome <user name>" to the documents body
			// const nameNode = document.createTextNode(`Welcome, ${res.name}`)
			// document.body.appendChild(nameNode)

			const tbl = document.getElementById('showRepos')
			const tblBody = document.createElement('tbody')
			var i = 0, j=0;
			for(i=0; i<res.length; i++){
				const tr = document.createElement('tr');
			for(j = 0 ; j < 4 ; j++){

				const count = document.createTextNode(i+1)
				const reposName = document.createTextNode(`${res[i].name}`)
				const reposCloneURL = document.createTextNode(`${res[i].clone_url}`)

				const url = `${res[i].clone_url}`;
				const ActionButton = document.createElement('button')
				ActionButton.innerHTML = "Click to Analyze"
				ActionButton.setAttribute("id","AnalyzeButton"+[i])
				ActionButton.setAttribute("onclick","clone('"+url+"')")

				const ResultButton = document.createElement('button')
				ResultButton.innerHTML = "Result"
				ResultButton.setAttribute("id", "Resultnum"+[i])
				ResultButton.setAttribute("style", "margin-left:8%;")

			  const td = document.createElement('td');
				if(j==0){
					td.appendChild(count)
				}else if(j==1){
					td.appendChild(reposName)
				}else if(j==2){
				td.appendChild(reposCloneURL)
			}
			else if(j==3){
				td.appendChild(ActionButton).className="btn btn-success"
				td.appendChild(ResultButton).className="btn btn-primary"
			}

			tr.appendChild(td);

			}
				tblBody.appendChild(tr);
			}
				tbl.appendChild(tblBody);

	})
	function clone(url) {

		const data = {github: url};

		const headers = {
			'Accept': 'application/json',
			'Content-Type': 'application/json'
		};

		const method = 'POST';

		const body = JSON.stringify(data);

		const payload = {
			method,
			headers,
			body,
		};

		fetch('http://localhost:8001/api/clone', payload).then(async (res) => {
			const data = await res.json();
			console.log(data);
		});
	}
	function logoutFunc(){
		fetch('http://localhost:8001/api/logout', { method:"GET" }).then( async (res)=>{
			alert("You have logout!");
		});
	}
	function finishCloning(){
		document.getElementById('CloneLoading').className = "d-none";
	  const doneText = document.createTextNode('done')
		document.appendChild(done)
	}
</script>
</html>
