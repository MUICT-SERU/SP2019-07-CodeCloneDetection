<html>
<head>
  <meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
		 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
		 <link href="styles.css" rel="stylesheet" />
</head>
<body>
  <nav class="navbar navbar-expand-md navbar-light bg-light">
      <ul class="nav">
          <li class="nav-item">
              <a class="nav-link">
                <img src="/images/logo.png" alt="Merry's logo" style="width:70px;height:70px;">
              </a>
          </li>
        <li class="nav-item" style="padding-top:15%">
            <a class="nav-link" href="/Result.html">Result</a>
        </li>
      </ul>
  <ul class="nav justify-content-end" id="menu" style="padding-left:83%">
    <li class="nav-item"id="ProPic">

    </li>
          <li class="nav-item">
              <b class="nav-link" id="logout-button" onclick="logoutFunc()" style="padding-top:35%">Logout</b>
          </li>
        </ul>
  </nav>
<div id="TextOutput" style="padding-left:7%;font:20px"></div>
</body>
<script>
const query = window.location.search.substring(1)
const token = query.split('access_token=')[1]

fetch('https://api.github.com/user',{
  headers: new Headers({
      'Authorization': 'token ' + token,
      }),
    }, {method : 'GET'})
  // Parse the response as JSON
  .then(res => res.json())
  .then(res =>{
    window.githubName = `${res.login}`;
    window.githubPicture = `${res.avatar_url}`;
    const ProfilePicture = document.createElement("img")
    ProfilePicture.setAttribute("style","width:70px;height:70px;")
    ProfilePicture.setAttribute("class", "img-thumbnail")
    ProfilePicture.src = githubPicture;

    document.getElementById("ProPic").appendChild(ProfilePicture)

  })
  var data = ({owner: window.githubName});
  const headers = {
    'Accept': 'application/json',
    'Content-Type': 'application/json'
  };

  const method = 'POST';

  const body = JSON.stringify(data);

  const payload = {
    method,
    headers,
    body,
  };
  fetch('http://localhost:8001/getHistory', payload).then(async (res)=>{
    const data = await res.json();
  	console.log(data);
    for(j=0;j<data.length;j++){
  		var json = `${data[j].result}`;
  		var jsonArray = json.split("\r\n");
  for(i=0; i < jsonArray.length; i++){
  const splitedResult = document.createTextNode(jsonArray[i]);
  const div = document.getElementById('TextOutput');
   const br = document.createElement('br');
  div.appendChild(splitedResult);
  div.appendChild(br);
}
}
  })
  function logoutFunc(){
    fetch('http://localhost:8001/api/logout', { method:"GET" }).then( async (res)=>{
      alert("You have logout!");
    });
  }
</script>
</html>
